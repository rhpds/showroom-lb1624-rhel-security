# Auditing with AuditD in Red Hat Enterprise Linux (RHEL) 9

## Objective: By the end of this lab, you will understand the nomenclature associated with AuditD, comprehend its functionality and purpose in RHEL 9, and be able to test for AuditD controls.

---

# Nomenclature Definitions

- **Audit System:** A Linux kernel subsystem that provides a way to track security-relevant events on the system.

- **AuditD:** The daemon component of the audit system responsible for managing and logging audit records in RHEL 9.

- **Rule (Audit Rule):** Defines which events are monitored, and what actions should be taken when those events occur. These rules are stored in files under `/etc/audit/` with a `.rules` extension.

- **Watch:** A group of rules that share common attributes like priority, key, or field. The `auditctl` command can be used to manage watches.

- **Log File:** A file where audit records are stored. The default location for log files is `/var/log/audit/audit.log`.

- **Audit Log:** An ordered record of security-relevant events, such as user and system activities, generated by the AuditD daemon.

- **Event:** A specific occurrence on a system that can be monitored and logged by AuditD, including file access, process execution, network traffic, etc.

- **Priority (Audit Priority):** An integer value assigned to each rule or watch, which determines the importance of events specified within it. Lower priority values have higher precedence.

- **Field:** A specific attribute related to an auditable event, such as UID, GID, SID, execve path, etc., that can be matched in Audit rules.

- **Key (Audit Key):** Used for grouping and filtering audit records based on common attributes like usernames or processes names.

---

# High Level Overview of AuditD

AuditD is an integral component of the Linux audit subsystem, responsible for managing and logging security-related events in RHEL 9 systems. Its primary role is to monitor and record system activities, providing valuable insights into potential security breaches or policy violations. Through configuration files (`.rules`) and command-line utilities (`auditctl`), AuditD can be customized to capture specific events based on user-defined rules and priorities.

AuditD logs its records in dedicated log files, usually located at `/var/log/audit/audit.log`, where administrators can analyze them using various tools (e.g., `ausearch` or `aulast`). By leveraging AuditD, organizations can enforce accountability and compliance with security policies and regulatory requirements.

---

# The Top 5 Issues That People Have With AuditD

1. **Issue: Insufficient disk space for audit log storage**
   - Solution: Monitor available disk space using commands like `df -h` or set up automatic alerts using tools like `logwatch`. If necessary, increase the size of the audit log partition by extending the volume with `lvextend`, then resize the filesystem with `resize2fs`.

   Example:
   ```
   # Check available disk space
   df -h
   # Extend logical volume (replace 'audit_vg' and 'audit_log' with your volumes)
   lvextend -L +10G /dev/audit_vg/audit_log
   # Resize filesystem on extended partition
   resize2fs /dev/audit_vg/audit_log
   ```

2. **Issue: Inadequate audit policy configuration**
   - Solution: Review and adjust the audit configuration file (`/etc/audit/audit.rules`) to ensure that critical events are being audited. Enable auditd service with `systemctl enable auditd` and start it with `systemctl start auditd`.

   Example:
   ```
   # Edit audit rules configuration
   sudo nano /etc/audit/rules.d/audit.rules
   # Add or modify rules, e.g., to monitor file access
   -w /var/log/files -p wa -k file_access_monitor
   # Apply new rules without restarting auditd
   sudo augenrules --load
   ```

3. **Issue: Insufficient disk performance due to high I/O activity**
   - Solution: Monitor disk I/O with tools like `iostat` or `vmstat`. Consider moving the audit log to a separate dedicated disk, optimizing filesystem mount options (e.g., noatime), or using SSDs for better performance.

   Example:
   ```
   # Monitor disk I/O
   iostat -dx 1
   # Mount options example, add to '/etc/fstab'
   /dev/sda1 /var/log ext4 defaults,noatime 0 2
   ```

4. **Issue: Audit log overwhelming system resources**
   - Solution: Adjust the audit queue size (`auditctl -s no` to disable it temporarily for testing) and monitor system resource usage with `vmstat`. Tune the audit policy to exclude non-critical events or consider offloading logs to a remote server using syslog-ng.

   Example:
   ```
   # Temporarily disable audit queue (for testing)
   sudo auditctl -s no
   # Monitor system resources
   vmstat 1
   # Install and configure syslog-ng for remote logging (example configuration)
   yum install syslog-ng
   sudo nano /etc/syslog-ng/syslog-ng.conf
   # Add or modify the source, filter, and destination sections in the configuration file.
   ```

5. **Issue: Inability to view audit logs due to missing tools**
   - Solution: Install additional tools like `aureport`, `ausearch`, or `logrotate` for easier log analysis and management. Enable automatic log rotation with `logrotate`.

   Example:
   ```
   # Install required packages
   sudo yum install aureport ausearch logrotate
   # Configure logrotate
   sudo nano /etc/logrotate.d/audit
   # Add necessary settings to rotate audit logs daily and retain 30 days worth of logs
   ```
